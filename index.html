<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Couple's Playland üíñ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom CSS untuk tema pastel dan animasi */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #fce4ec 0%, #e0f2f7 100%); /* Pastel pink to blue gradient */
            color: #333;
            overflow-x: hidden; /* Mencegah scroll horizontal */
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .landing-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .landing-page::before {
            content: '';
            position: absolute;
            top: -50px;
            left: -50px;
            width: 200px;
            height: 200px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: bubble 15s infinite ease-in-out;
            z-index: 0;
        }
        .landing-page::after {
            content: '';
            position: absolute;
            bottom: -70px;
            right: -70px;
            width: 250px;
            height: 250px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            animation: bubble 20s infinite reverse ease-in-out;
            z-index: 0;
        }
        @keyframes bubble {
            0% { transform: scale(1) translate(0, 0); opacity: 0.7; }
            50% { transform: scale(1.2) translate(20px, -20px); opacity: 0.5; }
            100% { transform: scale(1) translate(0, 0); opacity: 0.7; }
        }
        .couple-illustration {
            width: 250px;
            height: auto;
            margin-bottom: 30px;
            animation: float 3s ease-in-out infinite;
            z-index: 1;
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }
        .game-button {
            background-color: transparent; /* Latar belakang transparan */
            color: #ff5588; /* Warna teks pink yang lebih gelap agar terlihat */
            padding: 10px 15px; /* Kurangi padding */
            border-radius: 9999px; /* Tetap bulat */
            font-size: 1.25rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: none; /* Hilangkan bayangan */
            cursor: pointer;
            border: none;
            margin: 10px;
            display: flex; /* Untuk menempatkan ikon dan teks secara horizontal */
            align-items: center;
            justify-content: center;
            gap: 10px; /* Jarak antara ikon dan teks */
        }
        .game-button img {
            width: 30px; /* Ukuran ikon */
            height: 30px;
            /* Pastikan ikon tidak memiliki latar belakangnya sendiri jika PNG transparan */
        }
        .game-button:hover {
            background-color: rgba(255, 255, 255, 0.3); /* Sedikit latar belakang saat hover */
            transform: translateY(-3px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Tambahkan sedikit bayangan saat hover */
        }
        .game-section {
            display: none; /* Sembunyikan semua game secara default */
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .game-section.active {
            display: block;
        }
        .back-button {
            background-color: #88ddff; /* Light blue */
            color: white;
            padding: 10px 20px;
            border-radius: 9999px;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            border: none;
            margin-bottom: 20px;
        }
        .back-button:hover {
            background-color: #66ccff; /* Darker blue */
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
        }
        .audio-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
        }
        .audio-button {
            background-color: rgba(255, 255, 255, 0.7);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background-color 0.3s ease;
        }
        .audio-button:hover {
            background-color: rgba(255, 255, 255, 0.9);
        }
        .audio-button i {
            font-size: 24px;
            color: #ff99bb;
        }

        /* Styling spesifik untuk game Kiss or Dare */
        #kiss-or-dare .wheel-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 30px auto;
            border-radius: 50%;
            overflow: hidden;
            border: 5px solid #ff99bb;
            box-shadow: 0 0 15px rgba(255, 153, 187, 0.5);
        }
        #kiss-or-dare .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                #ffe0f0 0% 50%,
                #d0eaff 50% 100%
            );
            transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        #kiss-or-dare .pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 30px solid #ff5588;
            z-index: 10;
        }
        #kiss-or-dare .spin-button {
            margin-top: 20px;
            background-color: #88ddff;
        }
        #kiss-or-dare .challenge-display {
            margin-top: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #ff5588;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
            border: 2px dashed #ff99bb;
            border-radius: 10px;
        }
        #kiss-or-dare .add-custom-challenge {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f8ff;
            border-radius: 10px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
        }
        #kiss-or-dare .add-custom-challenge input[type="text"] {
            width: calc(100% - 100px);
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-right: 10px;
        }
        #kiss-or-dare .add-custom-challenge select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-right: 10px;
        }
        #kiss-or-dare .add-custom-challenge button {
            background-color: #aaffcc;
            color: #333;
            padding: 8px 15px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #kiss-or-dare .add-custom-challenge button:hover {
            background-color: #88eeaa;
        }

        /* Styling spesifik untuk game Ular Tangga Romantis */
        #snakes-and-ladders .board {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            width: 400px; /* Lebar papan */
            height: 400px; /* Tinggi papan */
            margin: 20px auto;
            border: 2px solid #ff99bb;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        #snakes-and-ladders .cell {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.8rem;
            font-weight: bold;
            border: 1px solid #eee;
            background-color: #fff;
            box-sizing: border-box;
            position: relative;
        }
        #snakes-and-ladders .cell.romantic {
            background-color: #ffe0f0; /* Pink pastel untuk kotak romantis */
        }
        #snakes-and-ladders .player {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.7rem;
            color: white;
            font-weight: bold;
            transition: all 0.5s ease-in-out;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        #snakes-and-ladders .player-1 { background-color: #ff5588; } /* Merah muda */
        #snakes-and-ladders .player-2 { background-color: #55aaff; } /* Biru */
        #snakes-and-ladders .dice-container {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #snakes-and-ladders .dice {
            width: 60px;
            height: 60px;
            background-color: #fff;
            border: 2px solid #ff99bb;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            font-weight: bold;
            color: #ff5588;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }
        #snakes-and-ladders .roll-dice-button {
            background-color: #aaffcc;
            color: #333;
        }
        #snakes-and-ladders .current-player-display {
            margin-top: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            color: #333;
        }
        #snakes-and-ladders .romantic-message {
            margin-top: 15px;
            font-size: 1.1rem;
            font-style: italic;
            color: #ff5588;
            min-height: 30px;
        }

        /* Styling spesifik untuk game Tebak Gambar */
        #draw-and-guess canvas {
            background-color: #fff;
            border: 2px solid #ff99bb;
            border-radius: 10px;
            margin: 20px auto;
            display: block;
            touch-action: none; /* Mencegah scrolling saat menggambar di mobile */
        }
        #draw-and-guess .drawing-controls {
            margin-top: 10px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        #draw-and-guess .drawing-controls button {
            padding: 8px 15px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            background-color: #88ddff;
            color: white;
            transition: background-color 0.3s ease;
        }
        #draw-and-guess .drawing-controls button:hover {
            background-color: #66ccff;
        }
        #draw-and-guess .drawing-controls input[type="color"] {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #draw-and-guess .guess-input {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        #draw-and-guess .guess-input input[type="text"] {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #draw-and-guess .guess-input button {
            background-color: #aaffcc;
            color: #333;
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #draw-and-guess .guess-input button:hover {
            background-color: #88eeaa;
        }
        #draw-and-guess .timer-display, #draw-and-guess .word-display {
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 10px;
            text-align: center;
            color: #ff5588;
        }
        #draw-and-guess .score-display {
            font-size: 1.1rem;
            margin-top: 10px;
            text-align: center;
        }
        #draw-and-guess .next-round-button {
            background-color: #ff99bb;
            color: white;
            margin-top: 20px;
        }

        /* Styling spesifik untuk game Tebak Kata Pasangan */
        #word-guess .clue-display {
            margin-top: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
            border: 2px dashed #88ddff;
            border-radius: 10px;
        }
        #word-guess .guess-input-word {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        #word-guess .guess-input-word input[type="text"] {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #word-guess .guess-input-word button {
            background-color: #aaffcc;
            color: #333;
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #word-guess .guess-input-word button:hover {
            background-color: #88eeaa;
        }
        #word-guess .score-display-word {
            font-size: 1.1rem;
            margin-top: 10px;
            text-align: center;
        }
        #word-guess .reset-score-button {
            background-color: #ff77aa;
            color: white;
            margin-top: 10px;
        }
        #word-guess .give-clue-button {
            background-color: #88ddff;
            color: white;
            margin-top: 20px;
        }
        #word-guess .new-word-button {
            background-color: #ff99bb;
            color: white;
            margin-top: 20px;
        }


        /* Styling spesifik untuk game Siapa Paling? */
        #who-is-most .question-display {
            margin-top: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
            border: 2px dashed #ff99bb;
            border-radius: 10px;
        }
        #who-is-most .answer-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        #who-is-most .answer-buttons button {
            flex-grow: 1;
            padding: 15px 30px;
            border-radius: 9999px;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        #who-is-most .answer-buttons button.player1 {
            background-color: #ff5588;
            color: white;
        }
        #who-is-most .answer-buttons button.player2 {
            background-color: #55aaff;
            color: white;
        }
        #who-is-most .answer-buttons button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        #who-is-most .result-display {
            margin-top: 30px;
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
            min-height: 50px;
        }
        #who-is-most .expression-animation {
            margin-top: 20px;
            font-size: 3rem;
            text-align: center;
            min-height: 80px;
        }
        #who-is-most .next-question-button {
            background-color: #aaffcc;
            color: #333;
            margin-top: 20px;
        }
        #who-is-most .reset-game-button {
            background-color: #ff77aa;
            color: white;
            margin-top: 10px;
        }

        /* Modal styling */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 80%;
            max-width: 500px;
            text-align: center;
            position: relative;
        }
        .close-button {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .landing-page h1 {
                font-size: 2.5rem;
            }
            .landing-page p {
                font-size: 1rem;
            }
            .game-button {
                padding: 12px 25px;
                font-size: 1rem;
            }
            #snakes-and-ladders .board {
                width: 300px;
                height: 300px;
            }
            #snakes-and-ladders .cell {
                font-size: 0.7rem;
            }
            #draw-and-guess canvas {
                width: 100%;
                height: auto; /* Biarkan tinggi menyesuaikan agar tidak terdistorsi */
            }
            #draw-and-guess .drawing-controls,
            #draw-and-guess .guess-input {
                flex-direction: column;
                gap: 5px;
            }
            #draw-and-guess .drawing-controls button,
            #draw-and-guess .guess-input button,
            #draw-and-guess .guess-input input[type="text"] {
                width: 100%;
            }
        }
    </style>
    <!-- Font Awesome untuk ikon musik -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Musik Latar -->
    <audio id="background-music" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- Kontrol Musik -->
    <div class="audio-controls">
        <button id="music-toggle" class="audio-button">
            <i class="fas fa-volume-up"></i>
        </button>
    </div>

    <!-- Landing Page -->
    <section id="landing-page" class="landing-page">
        <img src="/icons/pasangan.png" alt="Ilustrasi Pasangan" class="couple-illustration">
        <h1 class="text-5xl font-bold text-pink-600 mb-4">Couple's Playland üíñ</h1>
        <p class="text-xl text-gray-700 mb-8">Tempatnya game romantis dan playful untuk kalian berdua!</p>
        <div class="flex flex-wrap justify-center">
            <button class="game-button" onclick="showGame('kiss-or-dare')">
                <img src="/icons/kiss.png" alt="Kiss or Dare Icon"> Kiss or Dare
            </button>
            <button class="game-button" onclick="showGame('snakes-and-ladders')">
                <img src="/icons/dadu.png" alt="Dice Icon"> Ular Tangga Romantis
            </button>
            <button class="game-button" onclick="showGame('draw-and-guess')">
                <img src="/icons/draw.png" alt="Draw Icon"> Tebak Gambar
            </button>
            <button class="game-button" onclick="showGame('word-guess')">
                <img src="/icons/word.png" alt="Word Icon"> Tebak Kata Pasangan
            </button>
            <button class="game-button" onclick="showGame('who-is-most')">
                <img src="/icons/otak.png" alt="Brain Icon"> Siapa Paling?
            </button>
        </div>
    </section>

    <!-- Game Sections -->
    <div class="container">
        <!-- Kiss or Dare Game -->
        <section id="kiss-or-dare" class="game-section">
            <button class="back-button" onclick="showLandingPage()">Kembali ke Menu</button>
            <h2 class="text-3xl font-bold text-pink-600 mb-4 text-center">üíã Kiss or Dare</h2>
            <p class="text-center mb-4">Putar roda untuk tantangan romantis atau lucu!</p>
            <div class="wheel-container">
                <div class="wheel" id="kiss-dare-wheel"></div>
                <div class="pointer"></div>
            </div>
            <button class="game-button spin-button" onclick="spinWheel()">Putar Roda!</button>
            <div class="challenge-display" id="challenge-display">Siap untuk tantangan?</div>

            <div class="add-custom-challenge mt-8">
                <h3 class="text-xl font-bold text-gray-700 mb-3">Tambah Tantangan Kustom</h3>
                <input type="text" id="custom-challenge-input" placeholder="Masukkan tantangan baru..." class="w-full mb-3">
                <select id="custom-challenge-category" class="w-full mb-3 p-2 border rounded">
                    <option value="romantic">Romantis</option>
                    <option value="funny">Lucu</option>
                    <option value="hot-1">Hot Level 1</option>
                    <option value="hot-2">Hot Level 2</option>
                    <option value="hot-3">Hot Level 3</option>
                </select>
                <button onclick="addCustomChallenge()">Tambah Tantangan</button>
            </div>
        </section>

        <!-- Ular Tangga Romantis Game -->
        <section id="snakes-and-ladders" class="game-section">
            <button class="back-button" onclick="showLandingPage()">Kembali ke Menu</button>
            <h2 class="text-3xl font-bold text-pink-600 mb-4 text-center">üé≤ Ular Tangga Romantis</h2>
            <p class="text-center mb-4">Mainkan versi romantis dari Ular Tangga!</p>
            <div class="board" id="snake-ladder-board"></div>
            <div class="dice-container">
                <div class="dice" id="dice-display">1</div>
                <button class="game-button roll-dice-button" onclick="rollDice()">Lempar Dadu!</button>
                <div class="current-player-display" id="current-player-display">Giliran Pemain 1</div>
                <div class="romantic-message" id="romantic-message"></div>
            </div>
        </section>

        <!-- Tebak Gambar Game -->
        <section id="draw-and-guess" class="game-section">
            <button class="back-button" onclick="showLandingPage()">Kembali ke Menu</button>
            <h2 class="text-3xl font-bold text-pink-600 mb-4 text-center">üñºÔ∏è Tebak Gambar</h2>
            <p class="text-center mb-4">Satu menggambar, satu menebak!</p>
            <div class="text-center mb-2">
                <span class="word-display" id="draw-word-display">Kata: _____</span> |
                <span class="timer-display" id="draw-timer-display">Waktu: 30s</span>
            </div>
            <canvas id="drawing-canvas" width="400" height="300"></canvas>
            <div class="drawing-controls">
                <input type="color" id="color-picker" value="#000000">
                <input type="range" id="brush-size" min="1" max="10" value="3">
                <button onclick="clearCanvas()">Bersihkan</button>
                <button onclick="startDrawingRound()">Mulai Giliran Menggambar</button>
            </div>
            <div class="guess-input">
                <input type="text" id="guess-input-draw" placeholder="Tebak gambarnya..." class="w-full">
                <button onclick="submitGuessDraw()">Tebak!</button>
            </div>
            <div class="score-display" id="draw-score-display">Pemain 1: 0 | Pemain 2: 0</div>
            <button class="game-button next-round-button" onclick="nextDrawingRound()">Giliran Selanjutnya</button>
        </section>

        <!-- Tebak Kata Pasangan Game -->
        <section id="word-guess" class="game-section">
            <button class="back-button" onclick="showLandingPage()">Kembali ke Menu</button>
            <h2 class="text-3xl font-bold text-pink-600 mb-4 text-center">üî† Tebak Kata Pasangan</h2>
            <p class="text-center mb-4">Satu memberi petunjuk, satu menebak!</p>
            <div class="clue-display" id="clue-display"></div>
            <button class="game-button give-clue-button" onclick="generateClue()">Berikan Petunjuk</button>
            <div class="guess-input-word">
                <input type="text" id="guess-input-word" placeholder="Tebak katanya..." class="w-full">
                <button onclick="submitGuessWord()">Tebak!</button>
            </div>
            <div class="score-display-word" id="word-score-display">Pemain 1: 0 | Pemain 2: 0</div>
            <button class="game-button new-word-button" onclick="startNewWordRound()">Kata Baru</button>
            <button class="game-button reset-score-button" onclick="resetWordScore()">Reset Skor</button>
        </section>

        <!-- Siapa Paling? Game -->
        <section id="who-is-most" class="game-section">
            <button class="back-button" onclick="showLandingPage()">Kembali ke Menu</button>
            <h2 class="text-3xl font-bold text-pink-600 mb-4 text-center">üß† Siapa Paling?</h2>
            <p class="text-center mb-4">Siapa yang paling...?</p>
            <div class="question-display" id="who-is-most-question">Tekan 'Mulai' untuk pertanyaan!</div>
            <div class="answer-buttons">
                <button class="player1" id="player1-answer-btn" onclick="recordChoice(1)">Pemain 1</button>
                <button class="player2" id="player2-answer-btn" onclick="recordChoice(2)">Pemain 2</button>
            </div>
            <div class="result-display" id="who-is-most-result"></div>
            <div class="expression-animation" id="who-is-most-expression"></div>
            <button class="game-button next-question-button" onclick="nextWhoIsMostQuestion()">Pertanyaan Selanjutnya</button>
            <button class="game-button reset-game-button" onclick="resetWhoIsMostGame()">Mulai Ulang Game</button>
        </section>
    </div>

    <!-- Modal for messages -->
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <p id="modalMessage"></p>
        </div>
    </div>

    <script type="module">
        // Firebase imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, collection, query, where, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Firebase variables
        let app;
        let db;
        let auth;
        let userId;
        let isAuthReady = false;

        // Firebase config (from user prompt)
        const firebaseConfig = {
            apiKey: "AIzaSyBcEZ9v0NN5JIbz2EvOsbKZekVCP5Kqi4o",
            authDomain: "couplegame-834e5.firebaseapp.com",
            projectId: "couplegame-834e5",
            storageBucket: "couplegame-834e5.firebasestorage.app",
            messagingSenderId: "524054755775",
            appId: "1:524054755775:web:ea0239fbd097740fd5490a"
        };

        // App ID from Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Initialize Firebase and authenticate
        async function initializeFirebase() {
            try {
                console.log("Initializing Firebase with config:", firebaseConfig); // Debugging log
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                console.log("Firebase app and auth initialized."); // Debugging log

                let signedIn = false;
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token !== null && __initial_auth_token !== '') {
                    try {
                        console.log("Attempting sign-in with custom token..."); // Debugging log
                        await signInWithCustomToken(auth, __initial_auth_token);
                        signedIn = true;
                        console.log("Signed in with custom token successfully.");
                    } catch (customTokenError) {
                        console.warn("Custom token sign-in failed, attempting anonymous sign-in instead:", customTokenError);
                        // Fallback to anonymous sign-in if custom token fails
                        await signInAnonymously(auth);
                        signedIn = true;
                        console.log("Signed in anonymously after custom token failure.");
                    }
                }

                if (!signedIn) {
                    console.log("Custom token not provided or invalid, attempting anonymous sign-in...");
                    await signInAnonymously(auth);
                    console.log("Signed in anonymously.");
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("Firebase authenticated. User ID:", userId);
                    } else {
                        // This case should ideally not happen if signInAnonymously succeeds
                        userId = crypto.randomUUID(); // Fallback for unauthenticated
                        console.log("Firebase authentication state changed to unauthenticated. Using random user ID:", userId);
                    }
                    isAuthReady = true;
                    // You can now safely perform Firestore operations
                    loadChallengesFromFirestore();
                    loadSnakesAndLaddersState();
                    loadWordGuessState();
                    loadWhoIsMostState();
                });
            } catch (error) {
                console.error("Critical error during Firebase initialization or fallback authentication:", error);
                showMessage("Terjadi kesalahan fatal saat menginisialisasi game. Silakan coba lagi. Pastikan konfigurasi Firebase Anda benar dan layanan otentikasi diaktifkan.");
            }
        }

        // --- Global UI Functions ---
        function showGame(gameId) {
            document.querySelectorAll('.game-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('landing-page').style.display = 'none';
            document.getElementById(gameId).classList.add('active');
            // Specific game setup when shown
            if (gameId === 'draw-and-guess') {
                setupDrawingCanvas();
            } else if (gameId === 'snakes-and-ladders') {
                createBoard();
                updatePlayerPositions();
            } else if (gameId === 'word-guess') {
                updateWordScoreDisplay();
            } else if (gameId === 'who-is-most') {
                updateWhoIsMostUI();
            }
        }

        function showLandingPage() {
            document.querySelectorAll('.game-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('landing-page').style.display = 'flex';
        }

        // Modal functions
        const messageModal = document.getElementById('messageModal');
        const modalMessage = document.getElementById('modalMessage');
        const closeModalButton = document.querySelector('.close-button');

        function showMessage(message) {
            modalMessage.textContent = message;
            messageModal.style.display = 'flex';
        }

        function closeModal() {
            modalMessage.textContent = '';
            messageModal.style.display = 'none';
        }

        closeModalButton.onclick = closeModal;
        window.onclick = function(event) {
            if (event.target == messageModal) {
                closeModal();
            }
        }

        // --- Background Music ---
        const backgroundMusic = document.getElementById('background-music');
        const musicToggleButton = document.getElementById('music-toggle');
        let isMusicPlaying = false;

        musicToggleButton.addEventListener('click', () => {
            if (isMusicPlaying) {
                backgroundMusic.pause();
                musicToggleButton.innerHTML = '<i class="fas fa-volume-mute"></i>';
            } else {
                backgroundMusic.play().catch(e => console.error("Error playing music:", e));
                musicToggleButton.innerHTML = '<i class="fas fa-volume-up"></i>';
            }
            isMusicPlaying = !isMusicPlaying;
        });

        // Autoplay music on user interaction (e.g., first click)
        document.addEventListener('click', function playMusicOnce() {
            if (!isMusicPlaying) {
                backgroundMusic.play().then(() => {
                    isMusicPlaying = true;
                    musicToggleButton.innerHTML = '<i class="fas fa-volume-up"></i>';
                }).catch(e => console.error("Autoplay prevented:", e));
            }
            document.removeEventListener('click', playMusicOnce);
        });


        // --- Kiss or Dare Game Logic ---
        const kissDareWheel = document.getElementById('kiss-dare-wheel');
        const challengeDisplay = document.getElementById('challenge-display');
        const customChallengeInput = document.getElementById('custom-challenge-input');
        const customChallengeCategory = document.getElementById('custom-challenge-category');

        let challenges = {
            romantic: [
                "Cium kening pasanganmu dengan lembut.",
                "Berikan pelukan erat selama 10 detik.",
                "Bisikkan 3 hal yang paling kamu sukai dari pasanganmu.",
                "Tuliskan satu kalimat romantis di telapak tangannya.",
                "Pijat pundak pasanganmu selama 1 menit.",
                "Sanyikan lagu cinta favorit kalian berdua (walaupun fals!).",
                "Buatkan minuman kesukaan pasanganmu.",
                "Berikan 'high five' romantis.",
                "Tatap mata pasanganmu selama 30 detik tanpa bicara.",
                "Genggam tangan pasanganmu dan ceritakan kenangan favorit kalian.",
                "Beri tahu pasanganmu satu hal yang kamu syukuri tentang dia hari ini.",
                "Sebutkan julukan sayang kalian dan ceritakan asal-usulnya.",
                "Berikan pujian tulus tentang penampilan pasanganmu.",
                "Rencanakan kencan impian kalian berdua (secara lisan).",
                "Tanyakan satu pertanyaan mendalam tentang masa depan hubungan kalian.",
                "Berikan pijatan kaki singkat kepada pasanganmu.",
                "Tuliskan 'I ‚ù§Ô∏è U' di punggung pasanganmu dengan jari.",
                "Buat janji kecil yang bisa kalian tepati minggu ini.",
                "Ceritakan momen pertama kali kamu tahu kamu jatuh cinta padanya.",
                "Berikan satu kecupan di pipi setiap kali kamu menyebutkan hal baik tentang dia."
            ],
            funny: [
                "Ceritakan lelucon paling garing yang kamu tahu.",
                "Tirukan suara binatang peliharaan favoritmu.",
                "Berpose konyol dan biarkan pasanganmu memotretnya.",
                "Berjalan mundur selama 10 langkah.",
                "Bercerita tentang momen paling memalukan dalam hidupmu.",
                "Tirukan gaya bicara karakter kartun favoritmu.",
                "Buat wajah paling lucu yang kamu bisa.",
                "Nyanyikan lagu anak-anak dengan suara opera.",
                "Berpura-pura menjadi robot selama 1 menit.",
                "Ceritakan mimpi paling aneh yang pernah kamu alami.",
                "Lakukan tarian kemenangan yang konyol.",
                "Berikan pasanganmu 'high five' dengan kaki.",
                "Berpura-pura menjadi detektif dan coba pecahkan 'misteri' kecil di ruangan.",
                "Bicara dengan aksen aneh selama 1 menit.",
                "Buat suara kentut dengan ketiakmu (jika bisa!).",
                "Ceritakan kisah hantu yang tidak menakutkan.",
                "Berpura-pura menjadi patung selama 30 detik.",
                "Tirukan cara pasanganmu tertawa.",
                "Buat puisi dadakan tentang kaus kakimu.",
                "Makan satu sendok sambal (jika tidak pedas!)."
            ],
            'hot-1': [
                "Berikan ciuman leher yang lembut.",
                "Bisikkan fantasi rahasiamu ke telinga pasanganmu.",
                "Sentuh tangan pasanganmu dengan perlahan dan tatap matanya.",
                "Berikan pijatan punggung dengan jari-jari lembut.",
                "Tuliskan pesan 'nakal' di paha pasanganmu dengan jari.",
                "Berikan ciuman di bagian tubuh yang jarang kamu cium.",
                "Tanyakan satu hal yang paling membuat pasanganmu bergairah.",
                "Tatap mata pasanganmu dan bayangkan momen paling intim kalian.",
                "Berikan pelukan dari belakang dan bisikkan sesuatu yang genit.",
                "Genggam tangan pasanganmu dan rasakan detak jantungnya.",
                "Berikan ciuman singkat di bahu.",
                "Tanyakan satu hal yang ingin kamu coba di ranjang.",
                "Sentuh rambut pasanganmu dengan sensual.",
                "Bisikkan 'Aku menginginkanmu' ke telinganya.",
                "Berikan ciuman di pergelangan tangan.",
                "Tanyakan kapan terakhir kali pasanganmu merasa paling seksi.",
                "Sentuh pipi pasanganmu dengan lembut dan berikan ciuman singkat.",
                "Berikan ciuman di telinga.",
                "Tuliskan inisialmu di leher pasanganmu dengan lidahmu.",
                "Berikan ciuman di jari kaki."
            ],
            'hot-2': [
                "Cium bibir pasanganmu dengan gairah selama 10 detik.",
                "Lepaskan satu pakaian pasanganmu dengan mata tertutup.",
                "Berikan 'lap dance' singkat untuk pasanganmu.",
                "Bisikkan skenario fantasi terliar kamu ke telinga pasanganmu.",
                "Berikan ciuman basah di leher.",
                "Sentuh bagian tubuh pasanganmu yang paling kamu sukai.",
                "Ceritakan momen paling seksi yang pernah kalian alami bersama.",
                "Berikan ciuman di paha bagian dalam.",
                "Tanyakan satu hal yang paling membuat pasanganmu 'turn on'.",
                "Lakukan 'striptease' singkat (sesuai kenyamanan).",
                "Berikan ciuman di perut bagian bawah.",
                "Tuliskan pesan 'nakal' di tubuh pasanganmu dengan jari.",
                "Berikan ciuman di dada/payudara (sesuai kenyamanan).",
                "Tanyakan satu hal yang ingin pasanganmu lakukan padamu.",
                "Berikan pijatan sensual di area paha atau bokong.",
                "Bisikkan 'Aku ingin kamu sekarang' ke telinganya.",
                "Berikan ciuman di punggung bawah.",
                "Tanyakan posisi favorit pasanganmu.",
                "Sentuh bibir pasanganmu dengan jarimu dan tarik perlahan.",
                "Berikan ciuman di area sensitif (sesuai kenyamanan)."
            ],
            'hot-3': [
                "Cium seluruh tubuh pasanganmu dari leher hingga kaki.",
                "Lakukan 'oral sex' selama 2 menit (jika nyaman).",
                "Berikan 'spanking' ringan pada bokong pasanganmu.",
                "Bisikkan instruksi 'kotor' ke telinga pasanganmu.",
                "Berikan ciuman di area intim pasanganmu.",
                "Lakukan 'role play' singkat dengan skenario 'nakal'.",
                "Tanyakan satu hal yang belum pernah kalian coba tapi ingin sekali.",
                "Berikan pijatan seluruh tubuh dengan minyak pijat.",
                "Gunakan es batu untuk menjelajahi tubuh pasanganmu.",
                "Berikan 'deep kiss' yang panjang dan penuh gairah.",
                "Tanyakan satu hal yang paling membuat pasanganmu 'orgasme'.",
                "Berikan ciuman di area sensitif pasanganmu hingga ia merinding.",
                "Lakukan 'edging' pada pasanganmu (jika nyaman).",
                "Bisikkan 'Aku mencintaimu' saat kalian sedang dalam momen intim.",
                "Berikan ciuman di bagian tubuh yang paling tersembunyi.",
                "Tanyakan fantasi terliar pasanganmu yang belum terealisasi.",
                "Gunakan bulu atau kain lembut untuk menyentuh tubuh pasanganmu.",
                "Berikan ciuman yang mengarah ke area intim.",
                "Tuliskan namamu di tubuh pasanganmu dengan lidahmu.",
                "Berikan ciuman di area yang paling membuat pasanganmu bergairah."
            ]
        };

        const categories = Object.keys(challenges);
        const segments = categories.length; // Jumlah segmen pada roda
        const segmentAngle = 360 / segments;

        function updateWheelSegments() {
            let gradientString = 'conic-gradient(';
            let currentAngle = 0;
            const colors = ['#ffe0f0', '#d0eaff', '#ffe0f0', '#d0eaff', '#ffe0f0']; // Warna pastel bergantian

            categories.forEach((category, index) => {
                const startAngle = currentAngle;
                const endAngle = currentAngle + segmentAngle;
                gradientString += `${colors[index % colors.length]} ${startAngle}deg ${endAngle}deg${index < categories.length - 1 ? ',' : ''}`;
                currentAngle = endAngle;
            });
            gradientString += ')';
            kissDareWheel.style.background = gradientString;
        }

        function spinWheel() {
            const randomDegree = Math.floor(Math.random() * 3600) + 720; // Spin 2-10 kali
            kissDareWheel.style.transform = `rotate(${randomDegree}deg)`;

            setTimeout(() => {
                const normalizedDegree = randomDegree % 360;
                const segmentIndex = Math.floor(normalizedDegree / segmentAngle);
                const chosenCategory = categories[segmentIndex];
                const categoryChallenges = challenges[chosenCategory];
                if (categoryChallenges && categoryChallenges.length > 0) {
                    const randomChallenge = categoryChallenges[Math.floor(Math.random() * categoryChallenges.length)];
                    challengeDisplay.textContent = randomChallenge;
                    // TODO: Tambahkan logika poin jika diperlukan
                } else {
                    challengeDisplay.textContent = "Tidak ada tantangan untuk kategori ini. Coba tambahkan!";
                }
            }, 4000); // Sesuai dengan durasi transisi CSS
        }

        function addCustomChallenge() {
            const newChallenge = customChallengeInput.value.trim();
            const category = customChallengeCategory.value;

            if (newChallenge && challenges[category]) {
                challenges[category].push(newChallenge);
                customChallengeInput.value = '';
                showMessage("Tantangan kustom berhasil ditambahkan!");
                saveChallengesToFirestore(); // Simpan ke Firestore
            } else {
                showMessage("Mohon masukkan tantangan dan pilih kategori yang valid.");
            }
        }

        // Firestore functions for Kiss or Dare
        async function saveChallengesToFirestore() {
            if (!isAuthReady) {
                console.warn("Firebase not ready. Cannot save challenges.");
                return;
            }
            try {
                const docRef = doc(db, `artifacts/${appId}/users/${userId}/kiss-or-dare`, 'challenges');
                await setDoc(docRef, { data: JSON.stringify(challenges) });
                console.log("Challenges saved to Firestore.");
            } catch (e) {
                console.error("Error saving challenges:", e);
                showMessage("Gagal menyimpan tantangan. Silakan coba lagi.");
            }
        }

        async function loadChallengesFromFirestore() {
            if (!isAuthReady) {
                console.warn("Firebase not ready. Cannot load challenges.");
                return;
            }
            try {
                const docRef = doc(db, `artifacts/${appId}/users/${userId}/kiss-or-dare`, 'challenges');
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const loadedData = JSON.parse(docSnap.data().data);
                    // Merge loaded challenges with default ones, prioritizing loaded custom ones
                    for (const category in loadedData) {
                        if (challenges[category]) {
                            // Filter out duplicates if any, or just append
                            loadedData[category].forEach(challenge => {
                                if (!challenges[category].includes(challenge)) {
                                    challenges[category].push(challenge);
                                }
                            });
                        } else {
                            challenges[category] = loadedData[category]; // Add new categories if they exist
                        }
                    }
                    console.log("Challenges loaded from Firestore.");
                } else {
                    console.log("No challenges found in Firestore, using default.");
                    saveChallengesToFirestore(); // Save default if not present
                }
                updateWheelSegments(); // Update wheel after loading challenges
            } catch (e) {
                console.error("Error loading challenges:", e);
                showMessage("Gagal memuat tantangan. Menggunakan tantangan default.");
            }
        }


        // --- Ular Tangga Romantis Game Logic ---
        const boardSize = 10;
        const totalCells = boardSize * boardSize;
        let playerPositions = { player1: 1, player2: 1 };
        let currentPlayer = 1; // 1 for Player 1, 2 for Player 2
        const diceDisplay = document.getElementById('dice-display');
        const currentPlayerDisplay = document.getElementById('current-player-display');
        const romanticMessageDisplay = document.getElementById('romantic-message');

        // Snakes and Ladders (simplified for romantic twist)
        // Format: {startCell: endCell}
        const romanticSnakesAndLadders = {
            // Ladders (maju)
            4: 14, 9: 31, 20: 38, 28: 84, 40: 59, 51: 67, 63: 81, 71: 91,
            // Snakes (mundur)
            17: 7, 33: 11, 46: 25, 54: 34, 62: 19, 75: 56, 88: 68, 97: 79
        };

        const romanticCellMessages = {
            // Hot & Adult 21+ messages
            5: "Cium pasanganmu dengan gairah!",
            12: "Bisikkan fantasi 'nakal' ke telinganya.",
            18: "Sentuh bagian tubuh pasanganmu yang paling kamu sukai.",
            23: "Berikan pijatan sensual di area paha.",
            29: "Tanyakan satu hal yang paling membuat pasanganmu 'turn on'.",
            35: "Lakukan 'lap dance' singkat untuknya.",
            42: "Cium leher pasanganmu dengan lembut dan penuh hasrat.",
            48: "Berikan ciuman di paha bagian dalam.",
            55: "Ceritakan momen paling seksi yang pernah kalian alami bersama.",
            60: "Tuliskan pesan 'kotor' di punggung pasanganmu dengan jari.",
            66: "Berikan ciuman di perut bagian bawah.",
            72: "Tanyakan satu hal yang ingin pasanganmu lakukan padamu.",
            78: "Berikan pijatan sensual di area bokong.",
            83: "Bisikkan 'Aku ingin kamu sekarang' ke telinganya.",
            89: "Cium punggung bawah pasanganmu.",
            95: "Tanyakan posisi favorit pasanganmu di ranjang.",
            99: "Rayakan kemenangan dengan ciuman panjang dan penuh gairah!"
        };


        function createBoard() {
            const boardElement = document.getElementById('snake-ladder-board');
            boardElement.innerHTML = ''; // Clear existing board

            // Create cells in reverse order for correct numbering (bottom-left to top-right)
            for (let i = totalCells; i >= 1; i--) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.id = `cell-${i}`;
                cell.textContent = i;

                if (romanticCellMessages[i]) {
                    cell.classList.add('romantic');
                }

                boardElement.appendChild(cell);
            }

            // Adjust cell order for snake-like numbering (alternating rows)
            const cells = Array.from(boardElement.children);
            const orderedCells = [];
            for (let row = 0; row < boardSize; row++) {
                if (row % 2 === 0) { // Even rows (from bottom) go left-to-right
                    for (let col = 0; col < boardSize; col++) {
                        orderedCells.push(cells[cells.length - (row * boardSize + col + 1)]);
                    }
                } else { // Odd rows (from bottom) go right-to-left
                    for (let col = boardSize - 1; col >= 0; col--) {
                        orderedCells.push(cells[cells.length - (row * boardSize + col + 1)]);
                    }
                }
            }
            boardElement.innerHTML = '';
            orderedCells.forEach(cell => boardElement.appendChild(cell));

            // Add player tokens
            const player1Token = document.createElement('div');
            player1Token.classList.add('player', 'player-1');
            player1Token.id = 'player-token-1';
            player1Token.textContent = 'P1';
            boardElement.appendChild(player1Token);

            const player2Token = document.createElement('div');
            player2Token.classList.add('player', 'player-2');
            player2Token.id = 'player-token-2';
            player2Token.textContent = 'P2';
            boardElement.appendChild(player2Token);
        }

        function updatePlayerPositions() {
            for (const player in playerPositions) {
                const position = playerPositions[player];
                const token = document.getElementById(`player-token-${player === 'player1' ? 1 : 2}`);
                const targetCell = document.getElementById(`cell-${position}`);

                if (targetCell && token) {
                    const cellRect = targetCell.getBoundingClientRect();
                    const boardRect = document.getElementById('snake-ladder-board').getBoundingClientRect();

                    // Calculate position relative to the board
                    token.style.left = `${cellRect.left - boardRect.left + (cellRect.width / 2) - (token.offsetWidth / 2)}px`;
                    token.style.top = `${cellRect.top - boardRect.top + (cellRect.height / 2) - (token.offsetHeight / 2)}px`;
                }
            }
            saveSnakesAndLaddersState(); // Save state after updating positions
        }

        function rollDice() {
            const diceRoll = Math.floor(Math.random() * 6) + 1;
            diceDisplay.textContent = diceRoll;
            romanticMessageDisplay.textContent = ''; // Clear previous message

            let currentPlayerKey = `player${currentPlayer}`;
            let newPosition = playerPositions[currentPlayerKey] + diceRoll;

            if (newPosition > totalCells) {
                newPosition = totalCells; // Stay at 100 if overshoot
            }

            // Check for snakes/ladders
            if (romanticSnakesAndLadders[newPosition]) {
                const oldPosition = newPosition;
                newPosition = romanticSnakesAndLadders[newPosition];
                showMessage(`Pemain ${currentPlayer} bergerak dari ${oldPosition} ke ${newPosition} karena ada ${oldPosition < newPosition ? 'tangga romantis!' : 'ular romantis!'}`);
            }

            playerPositions[currentPlayerKey] = newPosition;
            updatePlayerPositions();

            // Check for romantic cell message
            if (romanticCellMessages[newPosition]) {
                romanticMessageDisplay.textContent = romanticCellMessages[newPosition];
                showMessage(`Pemain ${currentPlayer} mendarat di kotak romantis! ${romanticCellMessages[newPosition]}`);
            }

            if (newPosition === totalCells) {
                showMessage(`Selamat! Pemain ${currentPlayer} memenangkan Ular Tangga Romantis!`);
                resetSnakesAndLaddersGame();
            } else {
                currentPlayer = currentPlayer === 1 ? 2 : 1; // Switch player
                currentPlayerDisplay.textContent = `Giliran Pemain ${currentPlayer}`;
            }
        }

        function resetSnakesAndLaddersGame() {
            playerPositions = { player1: 1, player2: 1 };
            currentPlayer = 1;
            diceDisplay.textContent = '1';
            currentPlayerDisplay.textContent = 'Giliran Pemain 1';
            romanticMessageDisplay.textContent = '';
            updatePlayerPositions();
            saveSnakesAndLaddersState(); // Save reset state
        }

        // Firestore functions for Snakes and Ladders
        async function saveSnakesAndLaddersState() {
            if (!isAuthReady) {
                console.warn("Firebase not ready. Cannot save Snakes and Ladders state.");
                return;
            }
            try {
                const docRef = doc(db, `artifacts/${appId}/users/${userId}/snakes-and-ladders`, 'game-state');
                await setDoc(docRef, {
                    playerPositions: playerPositions,
                    currentPlayer: currentPlayer
                });
                console.log("Snakes and Ladders state saved.");
            } catch (e) {
                console.error("Error saving Snakes and Ladders state:", e);
                showMessage("Gagal menyimpan status Ular Tangga. Silakan coba lagi.");
            }
        }

        async function loadSnakesAndLaddersState() {
            if (!isAuthReady) {
                console.warn("Firebase not ready. Cannot load Snakes and Ladders state.");
                return;
            }
            try {
                const docRef = doc(db, `artifacts/${appId}/users/${userId}/snakes-and-ladders`, 'game-state');
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    playerPositions = data.playerPositions;
                    currentPlayer = data.currentPlayer;
                    currentPlayerDisplay.textContent = `Giliran Pemain ${currentPlayer}`;
                    console.log("Snakes and Ladders state loaded.");
                } else {
                    console.log("No Snakes and Ladders state found, starting new game.");
                    resetSnakesAndLaddersGame(); // Start new if no state
                }
                updatePlayerPositions();
            } catch (e) {
                console.error("Error loading Snakes and Ladders state:", e);
                showMessage("Gagal memuat status Ular Tangga. Memulai game baru.");
                resetSnakesAndLaddersGame();
            }
        }


        // --- Tebak Gambar Game Logic ---
        const drawingCanvas = document.getElementById('drawing-canvas');
        const ctx = drawingCanvas.getContext('2d');
        const colorPicker = document.getElementById('color-picker');
        const brushSize = document.getElementById('brush-size');
        const drawWordDisplay = document.getElementById('draw-word-display');
        const drawTimerDisplay = document.getElementById('draw-timer-display');
        const guessInputDraw = document.getElementById('guess-input-draw');
        const drawScoreDisplay = document.getElementById('draw-score-display');

        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let timer;
        let timeLeft = 30;
        let currentDrawingWord = '';
        let drawScores = { player1: 0, player2: 0 };
        let drawingPlayer = 1; // 1 for Player 1 (drawer), 2 for Player 2 (guesser)

        const drawingWords = {
            makanan: ["Pizza", "Es Krim", "Kopi", "Nasi Goreng", "Cokelat", "Burger", "Sushi", "Mie Ayam", "Roti", "Sup"],
            aktivitas_couple: ["Kencan", "Nonton Film", "Memasak", "Jalan-jalan", "Pelukan", "Ciuman", "Menari", "Piknik", "Bermain Game", "Bersepeda"],
            benda_kenangan: ["Cincin", "Surat Cinta", "Foto", "Boneka", "Tiket Konser", "Bunga Kering", "Jam Tangan", "Buku", "Kalung", "Gantungan Kunci"]
        };

        function setupDrawingCanvas() {
            // Adjust canvas size for responsiveness
            const containerWidth = drawingCanvas.parentElement.clientWidth;
            drawingCanvas.width = Math.min(containerWidth - 40, 600); // Max 600px, or container width - padding
            drawingCanvas.height = drawingCanvas.width * 0.75; // Maintain aspect ratio

            ctx.lineWidth = brushSize.value;
            ctx.lineCap = 'round';
            ctx.strokeStyle = colorPicker.value;

            drawingCanvas.addEventListener('mousedown', startDrawing);
            drawingCanvas.addEventListener('mousemove', draw);
            drawingCanvas.addEventListener('mouseup', stopDrawing);
            drawingCanvas.addEventListener('mouseout', stopDrawing); // Stop drawing if mouse leaves canvas

            // Touch events for mobile
            drawingCanvas.addEventListener('touchstart', (e) => {
                e.preventDefault(); // Prevent scrolling
                const touch = e.touches[0];
                startDrawing({ offsetX: touch.clientX - drawingCanvas.getBoundingClientRect().left, offsetY: touch.clientY - drawingCanvas.getBoundingClientRect().top });
            });
            drawingCanvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                draw({ offsetX: touch.clientX - drawingCanvas.getBoundingClientRect().left, offsetY: touch.clientY - drawingCanvas.getBoundingClientRect().top });
            });
            drawingCanvas.addEventListener('touchend', stopDrawing);
            drawingCanvas.addEventListener('touchcancel', stopDrawing);

            colorPicker.addEventListener('input', () => ctx.strokeStyle = colorPicker.value);
            brushSize.addEventListener('input', () => ctx.lineWidth = brushSize.value);

            updateDrawScoreDisplay();
        }

        function startDrawing(e) {
            if (drawingPlayer !== 1) return; // Only player 1 can draw
            isDrawing = true;
            [lastX, lastY] = [e.offsetX, e.offsetY];
        }

        function draw(e) {
            if (!isDrawing || drawingPlayer !== 1) return;
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(e.offsetX, e.offsetY);
            ctx.stroke();
            [lastX, lastY] = [e.offsetX, e.offsetY];
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
        }

        function startDrawingRound() {
            if (timer) clearInterval(timer);
            clearCanvas();
            guessInputDraw.value = '';
            drawingPlayer = 1; // Player 1 draws

            // Pick a random category and word
            const categories = Object.keys(drawingWords);
            const randomCategory = categories[Math.floor(Math.random() * categories.length)];
            const wordsInCat = drawingWords[randomCategory];
            currentDrawingWord = wordsInCat[Math.floor(Math.random() * wordsInCat.length)].toLowerCase();

            drawWordDisplay.textContent = `Kata: ${currentDrawingWord.split('').map(char => '_').join(' ')}`; // Hide word
            showMessage(`Pemain 1: Gambar kata "${currentDrawingWord}"!`);

            timeLeft = 30;
            drawTimerDisplay.textContent = `Waktu: ${timeLeft}s`;

            timer = setInterval(() => {
                timeLeft--;
                drawTimerDisplay.textContent = `Waktu: ${timeLeft}s`;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    showMessage(`Waktu habis! Kata yang benar adalah: ${currentDrawingWord}`);
                    nextDrawingRound();
                }
            }, 1000);
        }

        function submitGuessDraw() {
            if (drawingPlayer !== 2) { // Only player 2 can guess
                showMessage("Ini giliran pemain 1 untuk menggambar!");
                return;
            }
            const guess = guessInputDraw.value.trim().toLowerCase();
            if (guess === currentDrawingWord) {
                clearInterval(timer);
                drawScores.player2++; // Player 2 gets point for guessing
                drawScores.player1++; // Player 1 also gets point for drawing well
                updateDrawScoreDisplay();
                showMessage(`Tebakan benar! Kata: ${currentDrawingWord}. Poin untuk kedua pemain!`);
                nextDrawingRound();
            } else {
                showMessage("Tebakan salah. Coba lagi!");
            }
            guessInputDraw.value = '';
        }

        function updateDrawScoreDisplay() {
            drawScoreDisplay.textContent = `Pemain 1: ${drawScores.player1} | Pemain 2: ${drawScores.player2}`;
            saveDrawAndGuessState();
        }

        function nextDrawingRound() {
            // Switch roles for next round
            drawingPlayer = drawingPlayer === 1 ? 2 : 1;
            showMessage(`Giliran selanjutnya! Pemain ${drawingPlayer} akan menggambar.`);
            if (drawingPlayer === 1) {
                startDrawingRound(); // Player 1 draws
            } else {
                // For player 2's turn to draw, we need to pick a new word and let them draw
                // This game is designed for 1 device, so the "drawer" and "guesser" roles
                // are more conceptual. We'll just pick a new word and clear for the next round.
                startDrawingRound(); // Just restart the round, assuming players switch roles manually
            }
        }

        // Firestore functions for Draw and Guess
        async function saveDrawAndGuessState() {
            if (!isAuthReady) {
                console.warn("Firebase not ready. Cannot save Draw and Guess state.");
                return;
            }
            try {
                const docRef = doc(db, `artifacts/${appId}/users/${userId}/draw-and-guess`, 'game-state');
                await setDoc(docRef, {
                    scores: drawScores,
                    drawingPlayer: drawingPlayer,
                    currentWord: currentDrawingWord,
                    canvasData: drawingCanvas.toDataURL() // Save canvas image data
                });
                console.log("Draw and Guess state saved.");
            } catch (e) {
                console.error("Error saving Draw and Guess state:", e);
                showMessage("Gagal menyimpan status Tebak Gambar. Silakan coba lagi.");
            }
        }

        async function loadDrawAndGuessState() {
            if (!isAuthReady) {
                console.warn("Firebase not ready. Cannot load Draw and Guess state.");
                return;
            }
            try {
                const docRef = doc(db, `artifacts/${appId}/users/${userId}/draw-and-guess`, 'game-state');
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    drawScores = data.scores || { player1: 0, player2: 0 };
                    drawingPlayer = data.drawingPlayer || 1;
                    currentDrawingWord = data.currentWord || '';

                    // Load canvas data
                    if (data.canvasData) {
                        const img = new Image();
                        img.onload = () => {
                            ctx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
                            ctx.drawImage(img, 0, 0);
                        };
                        img.src = data.canvasData;
                    }
                    updateDrawScoreDisplay();
                    drawWordDisplay.textContent = `Kata: ${currentDrawingWord ? currentDrawingWord.split('').map(char => '_').join(' ') : '_____'}`;
                    console.log("Draw and Guess state loaded.");
                } else {
                    console.log("No Draw and Guess state found, starting new game.");
                    drawScores = { player1: 0, player2: 0 };
                    drawingPlayer = 1;
                    currentDrawingWord = '';
                    clearCanvas();
                    updateDrawScoreDisplay();
                }
            } catch (e) {
                console.error("Error loading Draw and Guess state:", e);
                showMessage("Gagal memuat status Tebak Gambar. Memulai game baru.");
                drawScores = { player1: 0, player2: 0 };
                drawingPlayer = 1;
                currentDrawingWord = '';
                clearCanvas();
                updateDrawScoreDisplay();
            }
        }


        // --- Tebak Kata Pasangan Game Logic ---
        const clueDisplay = document.getElementById('clue-display');
        const guessInputWord = document.getElementById('guess-input-word');
        const wordScoreDisplay = document.getElementById('word-score-display');

        let wordScores = { player1: 0, player2: 0 };
        let currentWord = '';
        let currentClue = '';

        const wordCategories = {
            cinta: ["Pelukan", "Ciuman", "Sayang", "Romantis", "Hati", "Kencan", "Setia", "Kasih", "Jodoh", "Momen", "Bahagia", "Impian", "Masa Depan", "Janji", "Bersama", "Cinta Sejati", "Kemesraan", "Gairah", "Hasrat", "Intim"],
            hobi_berdua: ["Memasak", "Nonton", "Jalan-jalan", "Olahraga", "Membaca", "Traveling", "Berkebun", "Bermain Musik", "Fotografi", "Gaming", "Menulis", "Melukis", "Menari", "Bersepeda", "Mendaki", "Memancing", "Menonton Konser", "Piknik", "Berkemah", "Yoga"],
            kenangan: ["Pertama", "Kencan", "Liburan", "Ulang Tahun", "Hadiah", "Foto", "Cerita", "Tawa", "Tangis", "Janji", "Tempat", "Lagu", "Film", "Makanan", "Momen", "Masa Lalu", "Masa Kecil", "Impian", "Rahasia", "Perjalanan"],
            lucu_lucuan: ["Kentut", "Ngorok", "Jelek", "Konyol", "Garing", "Lucu", "Aneh", "Gila", "Malu", "Geli", "Terjatuh", "Tersandung", "Salah", "Kaget", "Berisik", "Jail", "Usil", "Kikuk", "Bodoh", "Kocak"]
        };

        function startNewWordRound() {
            const categories = Object.keys(wordCategories);
            const randomCategory = categories[Math.floor(Math.random() * categories.length)];
            const wordsInCat = wordCategories[randomCategory];
            currentWord = wordsInCat[Math.floor(Math.random() * wordsInCat.length)].toLowerCase();
            currentClue = ''; // Reset clue

            clueDisplay.textContent = 'Tekan "Berikan Petunjuk" untuk clue!';
            guessInputWord.value = '';
            showMessage(`Kata baru telah dipilih. Pemain 1, berikan petunjuk untuk kata ini! (Kategori: ${randomCategory})`);
            console.log("Kata yang harus ditebak (hanya untuk pengembang):", currentWord); // For debugging
        }

        async function generateClue() {
            if (!currentWord) {
                showMessage("Mulai putaran baru terlebih dahulu dengan 'Kata Baru'.");
                return;
            }
            showMessage("Membuat petunjuk...");
            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: `Berikan petunjuk satu kata untuk kata "${currentWord}". Petunjuk harus singkat dan tidak menyebutkan kata aslinya. Contoh: Untuk 'apel', petunjuknya 'buah'.` }] });
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    currentClue = result.candidates[0].content.parts[0].text.trim();
                    clueDisplay.textContent = `Petunjuk: "${currentClue}"`;
                    showMessage("Pemain 2: Tebak katanya!");
                } else {
                    showMessage("Gagal membuat petunjuk. Coba lagi.");
                    console.error("API response error:", result);
                }
            }
            // Implement exponential backoff for API calls
            catch (error) {
                console.error("Error generating clue:", error);
                showMessage("Terjadi kesalahan saat membuat petunjuk. Pastikan koneksi internet Anda stabil.");
            }
        }

        function submitGuessWord() {
            if (!currentWord) {
                showMessage("Mulai putaran baru terlebih dahulu.");
                return;
            }
            const guess = guessInputWord.value.trim().toLowerCase();
            if (guess === currentWord) {
                wordScores.player2++; // Guesser gets point
                wordScores.player1++; // Clue giver also gets point
                updateWordScoreDisplay();
                showMessage(`Tebakan benar! Kata: ${currentWord}. Poin untuk kedua pemain!`);
                startNewWordRound(); // Start a new round automatically
            } else {
                showMessage("Tebakan salah. Coba lagi!");
            }
            guessInputWord.value = '';
        }

        function updateWordScoreDisplay() {
            wordScoreDisplay.textContent = `Pemain 1: ${wordScores.player1} | Pemain 2: ${wordScores.player2}`;
            saveWordGuessState();
        }

        function resetWordScore() {
            wordScores = { player1: 0, player2: 0 };
            updateWordScoreDisplay();
            showMessage("Skor tebak kata direset!");
            startNewWordRound();
        }

        // Firestore functions for Word Guess
        async function saveWordGuessState() {
            if (!isAuthReady) {
                console.warn("Firebase not ready. Cannot save Word Guess state.");
                return;
            }
            try {
                const docRef = doc(db, `artifacts/${appId}/users/${userId}/word-guess`, 'game-state');
                await setDoc(docRef, {
                    scores: wordScores,
                    currentWord: currentWord,
                    currentClue: currentClue
                });
                console.log("Word Guess state saved.");
            } catch (e) {
                console.error("Error saving Word Guess state:", e);
                showMessage("Gagal menyimpan status Tebak Kata. Silakan coba lagi.");
            }
        }

        async function loadWordGuessState() {
            if (!isAuthReady) {
                console.warn("Firebase not ready. Cannot load Word Guess state.");
                return;
            }
            try {
                const docRef = doc(db, `artifacts/${appId}/users/${userId}/word-guess`, 'game-state');
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    wordScores = data.scores || { player1: 0, player2: 0 };
                    currentWord = data.currentWord || '';
                    currentClue = data.currentClue || '';
                    clueDisplay.textContent = currentClue ? `Petunjuk: "${currentClue}"` : 'Tekan "Berikan Petunjuk" untuk clue!';
                    updateWordScoreDisplay();
                    console.log("Word Guess state loaded.");
                } else {
                    console.log("No Word Guess state found, starting new game.");
                    resetWordScore(); // This also calls startNewWordRound
                }
            } catch (e) {
                console.error("Error loading Word Guess state:", e);
                showMessage("Gagal memuat status Tebak Kata. Memulai game baru.");
                resetWordScore();
            }
        }


        // --- Siapa Paling? Game Logic ---
        const whoIsMostQuestionDisplay = document.getElementById('who-is-most-question');
        const player1AnswerBtn = document.getElementById('player1-answer-btn');
        const player2AnswerBtn = document.getElementById('player2-answer-btn');
        const whoIsMostResultDisplay = document.getElementById('who-is-most-result');
        const whoIsMostExpressionDisplay = document.getElementById('who-is-most-expression');

        const whoIsMostQuestions = [
            "Siapa yang paling posesif?",
            "Siapa yang paling romantis?",
            "Siapa yang paling sering lupa tanggal penting?",
            "Siapa yang paling jago masak?",
            "Siapa yang paling rapi?",
            "Siapa yang paling boros?",
            "Siapa yang paling sering memulai pertengkaran?",
            "Siapa yang paling sering minta maaf duluan?",
            "Siapa yang paling suka rebahan?",
            "Siapa yang paling sering memberi kejutan?",
            "Siapa yang paling cerewet?",
            "Siapa yang paling pendiam?",
            "Siapa yang paling suka traveling?",
            "Siapa yang paling suka nonton film horor?",
            "Siapa yang paling sering bangun pagi?",
            "Siapa yang paling suka begadang?",
            "Siapa yang paling jago nge-gombal?",
            "Siapa yang paling sering cemburu?",
            "Siapa yang paling suka berpetualang?",
            "Siapa yang paling sering mencuci piring?",
            "Siapa yang paling sering menjemput/mengantar?",
            "Siapa yang paling sering mengucapkan 'Aku cinta kamu'?",
            "Siapa yang paling sering memberi hadiah?",
            "Siapa yang paling suka memeluk?",
            "Siapa yang paling suka mencium?",
            "Siapa yang paling sering mengajak kencan?",
            "Siapa yang paling suka mendengarkan?",
            "Siapa yang paling sering curhat?",
            "Siapa yang paling suka merencanakan masa depan?",
            "Siapa yang paling suka hal-hal spontan?"
        ];

        let currentWhoIsMostQuestionIndex = 0;
        let p1_choice = null;
        let p2_choice = null;
        let currentAnsweringPlayer = 1; // 1 for P1, 2 for P2

        // Fungsi yang dipanggil saat tombol "Pemain 1" atau "Pemain 2" diklik
        function recordChoice(chosenPlayer) {
            if (currentAnsweringPlayer === 1) {
                p1_choice = chosenPlayer;
                showMessage("Pemain 1 telah memilih. Sekarang giliran Pemain 2 untuk memilih.");
                player1AnswerBtn.disabled = true;
                player2AnswerBtn.disabled = false; // Aktifkan tombol untuk P2
                // Perbarui teks tombol untuk menunjukkan pilihan P1
                player1AnswerBtn.textContent = (chosenPlayer === 1 ? 'Pemain 1 (Pilihan Anda)' : 'Pemain 2 (Pilihan P1)');
                player2AnswerBtn.textContent = (chosenPlayer === 2 ? 'Pemain 2 (Pilihan Anda)' : 'Pemain 1 (Pilihan P1)');
                currentAnsweringPlayer = 2; // Ganti giliran ke Pemain 2
            } else {
                p2_choice = chosenPlayer;
                showMessage("Pemain 2 telah memilih.");
                player1AnswerBtn.disabled = true;
                player2AnswerBtn.disabled = true; // Nonaktifkan kedua tombol setelah P2 memilih
                // Perbarui teks tombol untuk menunjukkan pilihan P2
                player1AnswerBtn.textContent = (chosenPlayer === 1 ? 'Pemain 1 (Pilihan P2)' : 'Pemain 2 (Pilihan P2)');
                player2AnswerBtn.textContent = (chosenPlayer === 2 ? 'Pemain 2 (Pilihan P2)' : 'Pemain 1 (Pilihan P2)');
                compareWhoIsMostAnswers();
                currentAnsweringPlayer = 1; // Reset giliran ke Pemain 1 untuk pertanyaan berikutnya
            }
        }

        function compareWhoIsMostAnswers() {
            // Kembalikan teks tombol ke "Pemain 1", "Pemain 2" sebelum menampilkan hasil
            player1AnswerBtn.textContent = 'Pemain 1';
            player2AnswerBtn.textContent = 'Pemain 2';

            if (p1_choice === p2_choice) {
                whoIsMostResultDisplay.textContent = "Kalian berdua setuju!";
                whoIsMostExpressionDisplay.textContent = "üòäüíñ"; // Happy, loving
            } else {
                whoIsMostResultDisplay.textContent = "Kalian tidak setuju!";
                whoIsMostExpressionDisplay.textContent = "ü§îüòÖ"; // Thinking, slightly embarrassed/amused
            }
            // Reset pilihan untuk putaran berikutnya
            p1_choice = null;
            p2_choice = null;
            saveWhoIsMostState();
        }

        function nextWhoIsMostQuestion() {
            currentWhoIsMostQuestionIndex = (currentWhoIsMostQuestionIndex + 1) % whoIsMostQuestions.length;
            updateWhoIsMostUI();
        }

        function resetWhoIsMostGame() {
            currentWhoIsMostQuestionIndex = 0;
            p1_choice = null; // Reset pilihan
            p2_choice = null;
            currentAnsweringPlayer = 1; // Reset pemain yang menjawab
            updateWhoIsMostUI();
            showMessage("Game 'Siapa Paling?' direset!");
        }

        function updateWhoIsMostUI() {
            if (whoIsMostQuestions.length === 0) {
                whoIsMostQuestionDisplay.textContent = "Tidak ada pertanyaan. Tambahkan pertanyaan baru!";
                player1AnswerBtn.style.display = 'none';
                player2AnswerBtn.style.display = 'none';
                return;
            }

            whoIsMostQuestionDisplay.textContent = whoIsMostQuestions[currentWhoIsMostQuestionIndex];
            whoIsMostResultDisplay.textContent = '';
            whoIsMostExpressionDisplay.textContent = '';
            player1AnswerBtn.disabled = false;
            player2AnswerBtn.disabled = false;
            player1AnswerBtn.style.backgroundColor = '#ff5588';
            player2AnswerBtn.style.backgroundColor = '#55aaff';
            player1AnswerBtn.textContent = 'Pemain 1'; // Pastikan teks asli
            player2AnswerBtn.textContent = 'Pemain 2'; // Pastikan teks asli
            saveWhoIsMostState();
        }


        // Firestore functions for Who Is Most?
        async function saveWhoIsMostState() {
            if (!isAuthReady) {
                console.warn("Firebase not ready. Cannot save Who Is Most state.");
                return;
            }
            try {
                const docRef = doc(db, `artifacts/${appId}/users/${userId}/who-is-most`, 'game-state');
                await setDoc(docRef, {
                    currentQuestionIndex: currentWhoIsMostQuestionIndex,
                    p1_choice: p1_choice,
                    p2_choice: p2_choice,
                    currentAnsweringPlayer: currentAnsweringPlayer
                });
                console.log("Who Is Most state saved.");
            } catch (e) {
                console.error("Error saving Who Is Most state:", e);
                showMessage("Gagal menyimpan status Siapa Paling?. Silakan coba lagi.");
            }
        }

        async function loadWhoIsMostState() {
            if (!isAuthReady) {
                console.warn("Firebase not ready. Cannot load Who Is Most state.");
                return;
            }
            try {
                const docRef = doc(db, `artifacts/${appId}/users/${userId}/who-is-most`, 'game-state');
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    currentWhoIsMostQuestionIndex = data.currentQuestionIndex || 0;
                    p1_choice = data.p1_choice || null;
                    p2_choice = data.p2_choice || null;
                    currentAnsweringPlayer = data.currentAnsweringPlayer || 1;
                    console.log("Who Is Most state loaded.");
                } else {
                    console.log("No Who Is Most state found, starting new game.");
                    resetWhoIsMostGame();
                }
                updateWhoIsMostUI(); // Update UI based on loaded state
            } catch (e) {
                console.error("Error loading Who Is Most state:", e);
                showMessage("Gagal memuat status Siapa Paling?. Memulai game baru.");
                resetWhoIsMostGame();
            }
        }


        // --- Initialize on Window Load ---
        window.onload = function() {
            initializeFirebase(); // Initialize Firebase first
            updateWheelSegments(); // Initial setup for Kiss or Dare wheel
            createBoard(); // Initial setup for Snakes and Ladders board
            setupDrawingCanvas(); // Initial setup for Drawing Canvas
            startNewWordRound(); // Initial setup for Word Guess
            updateWhoIsMostUI(); // Initial setup for Who Is Most?

            // Register Service Worker
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/service-worker.js')
                        .then(registration => {
                            console.log('Service Worker registered with scope:', registration.scope);
                        })
                        .catch(error => {
                            console.error('Service Worker registration failed:', error);
                        });
                });
            }
        };

        // Ensure all Firestore calls are wrapped in checks for `isAuthReady`
        // and handle potential errors with `try/catch` and `showMessage`.
    </script>
</body>
</html>
